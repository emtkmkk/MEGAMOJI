export const table: { [key: string]: string } = {
  いぇ: "ye",
  うぁ: "wha",
  うぃ: "wi",
  うぇ: "we",
  うぉ: "who",
  ゔぁ: "va",
  ゔぃ: "vi",
  ゔぇ: "ve",
  ゔぉ: "vo",
  ゔゃ: "vya",
  ゔゅ: "vyu",
  ゔょ: "vyo",
  きゃ: "kya",
  きぃ: "kyi",
  きゅ: "kyu",
  きぇ: "kye",
  きょ: "kyo",
  ぎゃ: "gya",
  ぎぃ: "gyi",
  ぎゅ: "gyu",
  ぎぇ: "gye",
  ぎょ: "gyo",
  くぁ: "kwa",
  くぃ: "kwi",
  くぅ: "kwu",
  くぇ: "kwe",
  くぉ: "kwo",
  ぐぁ: "gwa",
  ぐぃ: "gwi",
  ぐぅ: "gwu",
  ぐぇ: "gwe",
  ぐぉ: "gwo",
  しゃ: "sha",
  しぃ: "syi",
  しゅ: "shu",
  しぇ: "she",
  しょ: "sho",
  じゃ: "ja",
  じぃ: "jyi",
  じゅ: "ju",
  じぇ: "je",
  じょ: "jo",
  ちゃ: "cha",
  ちぃ: "cyi",
  ちゅ: "chu",
  ちぇ: "che",
  ちょ: "cho",
  ぢゃ: "dya",
  ぢぃ: "dyi",
  ぢゅ: "dyu",
  ぢぇ: "dye",
  ぢょ: "dyo",
  つぁ: "tsa",
  つぃ: "tsi",
  つぇ: "tse",
  つぉ: "tso",
  てゃ: "tha",
  てぃ: "thi",
  てゅ: "thu",
  てぇ: "the",
  てょ: "tho",
  でゃ: "dha",
  でぃ: "dhi",
  でゅ: "dhu",
  でぇ: "dhe",
  でょ: "dho",
  とぁ: "twa",
  とぃ: "twi",
  とぅ: "twu",
  とぇ: "twe",
  とぉ: "two",
  どぁ: "dwa",
  どぃ: "dwi",
  どぅ: "dwu",
  どぇ: "dwe",
  どぉ: "dwo",
  にゃ: "nya",
  にぃ: "nyi",
  にゅ: "nyu",
  にぇ: "nye",
  にょ: "nyo",
  ひゃ: "hya",
  ひぃ: "hyi",
  ひゅ: "hyu",
  ひぇ: "hye",
  ひょ: "hyo",
  ぴゃ: "pya",
  ぴぃ: "pyi",
  ぴゅ: "pyu",
  ぴぇ: "pye",
  ぴょ: "pyo",
  びゃ: "bya",
  びぃ: "byi",
  びぇ: "bye",
  びゅ: "byu",
  びょ: "byo",
  ふぁ: "fa",
  ふぃ: "fi",
  ふぇ: "fe",
  ふぉ: "fo",
  ふゃ: "fya",
  ふゅ: "fyu",
  ふょ: "fyo",
  みゃ: "mya",
  みぃ: "myi",
  みゅ: "myu",
  みぇ: "mye",
  みょ: "myo",
  りゃ: "rya",
  りぃ: "ryi",
  りゅ: "ryu",
  りぇ: "rye",
  りょ: "ryo",
  あ: "a",
  い: "i",
  う: "u",
  え: "e",
  お: "o",
  か: "ka",
  き: "ki",
  く: "ku",
  け: "ke",
  こ: "ko",
  さ: "sa",
  し: "si",
  す: "su",
  せ: "se",
  そ: "so",
  た: "ta",
  ち: "ti",
  つ: "tu",
  て: "te",
  と: "to",
  な: "na",
  に: "ni",
  ぬ: "nu",
  ね: "ne",
  の: "no",
  は: "ha",
  ひ: "hi",
  ふ: "fu",
  へ: "he",
  ほ: "ho",
  ま: "ma",
  み: "mi",
  む: "mu",
  め: "me",
  も: "mo",
  や: "ya",
  ゆ: "yu",
  よ: "yo",
  ら: "ra",
  り: "ri",
  る: "ru",
  れ: "re",
  ろ: "ro",
  わ: "wa",
  を: "wo",
  ん: "n",
  が: "ga",
  ぎ: "gi",
  ぐ: "gu",
  げ: "ge",
  ご: "go",
  ざ: "za",
  じ: "ji",
  ず: "zu",
  ぜ: "ze",
  ぞ: "zo",
  だ: "da",
  ぢ: "di",
  づ: "du",
  で: "de",
  ど: "do",
  ば: "ba",
  び: "bi",
  ぶ: "bu",
  べ: "be",
  ぼ: "bo",
  ぱ: "pa",
  ぴ: "pi",
  ぷ: "pu",
  ぺ: "pe",
  ぽ: "po",
  ぁ: "xa",
  ぃ: "xi",
  ぅ: "xu",
  ぇ: "xe",
  ぉ: "xo",
  ゃ: "xya",
  ゅ: "xyu",
  ょ: "xyo",
  ゎ: "xwa",
  ゕ: "xka", // 実際には "ヵ" になる
  ゖ: "xke", // 実際には "ヶ" になる
  ゔ: "vu",
  ゐ: "wyi",
  ゑ: "wye",
  ー: "_",
  "！": "i",
  "?": "q",
  "？": "q",
};

export function jaToRoomaji(str: string): string {
  // ひらがなかカタカナか全角半角英数字だけでなければ終了
  if (!/^[ぁ-んァ-ンー！？?A-Za-z0-9Ａ-Ｚａ-ｚ０-９\s]+$/.test(str)) {
    return str;
  }

  return hiraToRoma(kanaToHira(toHalfWidth(str)));
}

function kanaToHira(str: string): string {
  return str.replace(/[ァ-ン]/g, (match) => {
    const chr = match.charCodeAt(0) - 0x60;
    return String.fromCharCode(chr);
  });
}

export function hiraToRoma(str: string): string {
  const regTu = /っ([bcdfghjklmpqrstvwxyz])/gm;
  const regXtu = /っ/gm;

  const max = str.length;
  let index = 0;
  let roma = "";

  while (index < max) {
    let char = "";
    const twoChars = str.substring(index, index + 2);
    const oneChar = str.substring(index, index + 1);
    if (twoChars in table) {
      char = table[twoChars];
      index += 2;
    } else {
      char = table[oneChar] || oneChar;
      index += 1;
    }
    roma += char;
  }
  roma = roma.replace(regTu, "$1$1");
  roma = roma.replace(regXtu, "xtu");
  return roma;
}

function toHalfWidth(str: string): string {
  // 全角英数字を半角に変換
  const replaceStr = str.replace(
    /[Ａ-Ｚａ-ｚ０-９]/g,
    (s) => String.fromCharCode(s.charCodeAt(0) - 0xFEE0),
  );
  return replaceStr;
}
